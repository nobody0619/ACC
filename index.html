<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <title>Latihan Maklumat Tambahan â€“ Debit / Kredit Drag & Drop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- PapaParse è¯»å– CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f5fb;
      color: #222;
    }
    header {
      background: #2f3ec9;
      color: #fff;
      padding: 14px 18px;
    }
    header h1 {
      margin: 0;
      font-size: 1.2rem;
    }
    header p {
      margin: 4px 0 0;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    main {
      max-width: 900px;
      margin: 16px auto 40px;
      padding: 0 12px;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px 18px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      margin-bottom: 16px;
    }

    .question-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      margin-bottom: 8px;
      color: #555;
    }

    .question-text {
      font-size: 1rem;
      line-height: 1.4;
      margin-bottom: 10px;
    }

    .topic-tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #eef;
      color: #223;
    }

    .zones {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin: 12px 0 16px;
    }

    .drop-zone {
      border: 2px dashed #b7b7d9;
      border-radius: 12px;
      padding: 16px;
      min-height: 60px;
      text-align: center;
      font-size: 0.95rem;
      background: #fafafe;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .drop-zone.filled {
      border-style: solid;
      background: #f3f6ff;
    }

    .drop-zone-label {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 0.9rem;
      color: #444;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 10px;
      margin: 4px;
      border-radius: 999px;
      background: #e5e7ff;
      cursor: grab;
      font-size: 0.85rem;
      user-select: none;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    .chip:active {
      transform: scale(0.96);
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      cursor: grabbing;
    }

    .chip.used {
      opacity: 0.55;
      background: #dddff7;
      cursor: default;
    }

    .chip.correct {
      background: #c6f6d5;
    }

    .chip.wrong {
      background: #fed7d7;
    }

    .choices-wrapper {
      margin-top: 8px;
    }

    .choices-title {
      font-size: 0.9rem;
      margin-bottom: 4px;
      font-weight: 600;
      color: #444;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      background: #2f3ec9;
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    button.secondary {
      background: #e2e6ff;
      color: #222;
    }

    button.outline {
      background: transparent;
      border: 1px solid #c3c7ff;
      color: #222;
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .status-line {
      font-size: 0.9rem;
      margin-top: 8px;
      min-height: 20px;
    }

    .status-line.ok {
      color: #0f8a3b;
    }

    .status-line.err {
      color: #c53030;
    }

    .score-bar {
      font-size: 0.9rem;
      margin-bottom: 8px;
      color: #444;
    }

    .hint {
      font-size: 0.8rem;
      color: #666;
      margin-top: 4px;
    }

    @media (max-width: 640px) {
      .zones {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<header>
  <h1>Latihan Maklumat Tambahan (Drag & Drop)</h1>
  <p>Belanja/Hasil belum bayar & prabayar Â· Susut nilai Â· Hutang lapuk â€“ latihan format Debit/Kredit</p>
</header>

<main>
  <div class="card">
    <div class="score-bar">
      Soalan: <span id="qNumber">0</span> /
      <span id="qTotal">0</span> Â·
      Betul: <span id="qCorrect">0</span> Â·
      Salah (akan diulang): <span id="qWrong">0</span>
    </div>
    <div class="question-meta">
      <div>Topik: <span id="qTopic" class="topic-tag">â€“</span></div>
      <div id="qId"></div>
    </div>
    <div id="qText" class="question-text">Memuatkan soalan...</div>

    <div class="zones">
      <div>
        <div class="drop-zone-label">Debit</div>
        <div id="debitZone" class="drop-zone" data-zone="debit"></div>
      </div>
      <div>
        <div class="drop-zone-label">Kredit</div>
        <div id="creditZone" class="drop-zone" data-zone="credit"></div>
      </div>
    </div>

    <div class="choices-wrapper">
      <div class="choices-title">Seret kad akaun yang betul ke kotak Debit dan Kredit:</div>
      <div id="choiceContainer"></div>
      <div class="hint">Tip: Jawap seperti di lejar larasan â€“ Akaun yang didebit & dikredit.</div>
    </div>

    <div class="buttons">
      <button id="checkBtn">Semak jawapan</button>
      <button id="showBtn" class="secondary">Tunjuk jawapan</button>
      <button id="nextBtn" class="outline">Soalan seterusnya â­</button>
    </div>

    <div id="status" class="status-line"></div>
  </div>

  <div class="card">
    <h3 style="margin-top:0">Cara penggunaan (untukè€å¸ˆ)</h3>
    <ol style="font-size:0.9rem; padding-left:18px; margin-top:6px">
      <li>`questions.csv` å¯è‡ªç”±åŠ é¢˜ï¼š<code>topic</code> åªæ˜¯åˆ†ç±»ï¼Œä¸å½±å“åˆ¤åˆ†ã€‚</li>
      <li>å­¦ç”Ÿæ‹–åŠ¨è´¦æˆ·åç§°åˆ° Debit / Kreditï¼ŒæŒ‰ã€ŒSemak jawapanã€ã€‚</li>
      <li>ç­”é”™æ—¶ï¼Œè¿™é¢˜ä¼šè¢«ä¸¢å›é¢˜ç›®é˜Ÿåˆ—<strong>ä¸¤æ¬¡</strong>ï¼Œç¡®ä¿å¤šç»ƒã€‚</li>
      <li>å¯æ”¾åœ¨ GitHub Pagesï¼Œå­¦ç”Ÿåªéœ€æ‰‹æœºæµè§ˆå™¨å°±èƒ½ç»ƒä¹ ã€‚</li>
    </ol>
  </div>
</main>

<script>
  const topicNames = {
    belanja_belum_bayar: "Belanja belum bayar (accrual)",
    belanja_prabayar: "Belanja prabayar (prepaid)",
    hasil_belum_terima: "Hasil belum terima (accrual)",
    hasil_belum_terperoleh: "Hasil belum terperoleh (prepaid hasil)",
    susut_nilai: "Susut nilai",
    hutang_lapuk: "Hutang lapuk / terpulih"
  };

  let questions = [];
  let queue = [];        // é¡ºåºé˜Ÿåˆ—ï¼ˆå«é‡å¤ï¼‰
  let currentIndex = null;
  let currentQuestion = null;
  let correctCount = 0;
  let wrongCount = 0;

  const qNumberEl = document.getElementById("qNumber");
  const qTotalEl = document.getElementById("qTotal");
  const qCorrectEl = document.getElementById("qCorrect");
  const qWrongEl = document.getElementById("qWrong");
  const qTopicEl = document.getElementById("qTopic");
  const qIdEl = document.getElementById("qId");
  const qTextEl = document.getElementById("qText");
  const debitZone = document.getElementById("debitZone");
  const creditZone = document.getElementById("creditZone");
  const choiceContainer = document.getElementById("choiceContainer");
  const statusEl = document.getElementById("status");
  const checkBtn = document.getElementById("checkBtn");
  const showBtn = document.getElementById("showBtn");
  const nextBtn = document.getElementById("nextBtn");

  // è¯»å– CSV
  Papa.parse("questions.csv", {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(res) {
      questions = res.data.filter(row => row.id && row.question);
      if (!questions.length) {
        qTextEl.textContent = "Tiada soalan ditemui dalam questions.csv.";
        return;
      }
      // å»ºç«‹åˆå§‹é˜Ÿåˆ—
      queue = questions.map((_, idx) => idx);
      qTotalEl.textContent = questions.length;
      loadNextQuestion();
    },
    error: function() {
      qTextEl.textContent = "Gagal memuatkan questions.csv. Sila semak nama fail / lokasi.";
    }
  });

  function clearZones() {
    [debitZone, creditZone].forEach(zone => {
      zone.innerHTML = "";
      zone.classList.remove("filled");
    });
  }

  function renderChoices(question) {
    choiceContainer.innerHTML = "";
    const choices = (question.choices || "").split(";").map(s => s.trim()).filter(Boolean);

    choices.forEach((text, index) => {
      const chip = document.createElement("div");
      chip.className = "chip";
      chip.textContent = text;
      chip.draggable = true;
      chip.dataset.choice = text;
      chip.dataset.index = index;

      chip.addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("text/plain", text);
        e.dataTransfer.effectAllowed = "move";
      });

      choiceContainer.appendChild(chip);
    });
  }

  function setupDropZone(zoneEl) {
    zoneEl.addEventListener("dragover", (e) => {
      e.preventDefault();
      e.dataTransfer.dropEffect = "move";
      zoneEl.classList.add("filled");
    });

    zoneEl.addEventListener("dragleave", () => {
      if (!zoneEl.textContent.trim()) {
        zoneEl.classList.remove("filled");
      }
    });

    zoneEl.addEventListener("drop", (e) => {
      e.preventDefault();
      const text = e.dataTransfer.getData("text/plain");
      if (!text) return;

      // æ¯ä¸ª zone åªæ”¾ä¸€ä¸ª chipï¼šå¦‚æœå·²æœ‰å†…å®¹å…ˆé‡Šæ”¾åŸ chip
      zoneEl.innerHTML = "";
      const chip = document.createElement("div");
      chip.className = "chip";
      chip.textContent = text;
      chip.dataset.choice = text;
      zoneEl.appendChild(chip);
      zoneEl.classList.add("filled");

      // æ ‡è®°åŸåˆ—è¡¨é‡Œçš„ chip ä¸º usedï¼ˆè§†è§‰åé¦ˆï¼‰
      const listChips = choiceContainer.querySelectorAll(".chip");
      listChips.forEach(c => {
        if (c.dataset.choice === text) {
          c.classList.add("used");
        }
      });
    });
  }

  setupDropZone(debitZone);
  setupDropZone(creditZone);

  function loadNextQuestion() {
    statusEl.textContent = "";
    statusEl.className = "status-line";

    clearZones();
    // å–é˜Ÿåˆ—ä¸‹ä¸€é¢˜
    if (!queue.length) {
      qTextEl.textContent = "Tahniah! Semua soalan telah dijawab. Tekan Soalan seterusnya untuk ulang satu pusingan baru.";
      // é‡å»ºé˜Ÿåˆ—
      queue = questions.map((_, idx) => idx);
      return;
    }

    currentIndex = queue.shift();
    currentQuestion = questions[currentIndex];

    qNumberEl.textContent = (questions.length - queue.length); // å·²ç»åšäº†å¤šå°‘
    qTopicEl.textContent = topicNames[currentQuestion.topic] || currentQuestion.topic || "Topik";
    qIdEl.textContent = "ID: " + currentQuestion.id;
    qTextEl.textContent = currentQuestion.question;

    renderChoices(currentQuestion);
  }

  function getZoneAnswer(zoneEl) {
    const chip = zoneEl.querySelector(".chip");
    return chip ? chip.dataset.choice : "";
  }

  function checkAnswer() {
    if (!currentQuestion) return;
    const d = getZoneAnswer(debitZone);
    const c = getZoneAnswer(creditZone);

    if (!d || !c) {
      statusEl.textContent = "Lengkapkan kedua-dua kotak Debit dan Kredit dahulu.";
      statusEl.className = "status-line err";
      return;
    }

    const correctD = (d === currentQuestion.debit_answer);
    const correctC = (c === currentQuestion.credit_answer);

    // é‡è®¾ chip é¢œè‰²
    [debitZone, creditZone].forEach(zone => {
      const chip = zone.querySelector(".chip");
      if (!chip) return;
      chip.classList.remove("correct", "wrong");
    });

    const dChip = debitZone.querySelector(".chip");
    const cChip = creditZone.querySelector(".chip");

    if (correctD && correctC) {
      if (dChip) dChip.classList.add("correct");
      if (cChip) cChip.classList.add("correct");
      statusEl.textContent = "Betul! ğŸ‘";
      statusEl.className = "status-line ok";
      correctCount++;
      qCorrectEl.textContent = correctCount;
    } else {
      if (dChip) dChip.classList.add(correctD ? "correct" : "wrong");
      if (cChip) cChip.classList.add(correctC ? "correct" : "wrong");
      statusEl.textContent = "Masih ada yang salah. Soalan ini akan diulang dua kali lagi.";
      statusEl.className = "status-line err";
      wrongCount++;
      qWrongEl.textContent = wrongCount;
      // é¢˜ç›®é‡æ–°åŠ å…¥é˜Ÿåˆ—ä¸¤æ¬¡
      queue.push(currentIndex, currentIndex);
    }
  }

  function showAnswer() {
    if (!currentQuestion) return;

    clearZones();

    function putInZone(zoneEl, text) {
      const chip = document.createElement("div");
      chip.className = "chip correct";
      chip.textContent = text;
      zoneEl.appendChild(chip);
      zoneEl.classList.add("filled");
    }

    putInZone(debitZone, currentQuestion.debit_answer);
    putInZone(creditZone, currentQuestion.credit_answer);

    statusEl.textContent = "Inilah jawapan penuh untuk soalan ini.";
    statusEl.className = "status-line ok";
  }

  checkBtn.addEventListener("click", checkAnswer);
  showBtn.addEventListener("click", showAnswer);
  nextBtn.addEventListener("click", loadNextQuestion);
</script>
</body>
</html>
