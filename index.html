<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <title>Latihan Maklumat Tambahan - Belanja & Hasil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
      line-height: 1.5;
    }
    h1 { font-size: 1.4rem; margin-bottom: 0.2rem; }
    .card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 16px;
      margin-top: 12px;
    }
    .label { font-weight: 600; margin-top: 8px; display: block; }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 6px 8px;
      margin-top: 4px;
      box-sizing: border-box;
    }
    button {
      padding: 8px 14px;
      margin-right: 8px;
      margin-top: 10px;
      cursor: pointer;
    }
    #feedback { margin-top: 10px; font-weight: 600; }
    .correct { color: #157347; }
    .wrong { color: #b02a37; }
    #status { margin-top: 8px; font-size: 0.9rem; color: #555; }
    code { background: #f5f5f5; padding: 2px 4px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Latihan Maklumat Tambahan</h1>
  <p>
    Fokus: <b>Belanja belum bayar, Belanja prabayar, Hasil belum terima, Hasil belum terperoleh</b><br>
    Jawab ikut format SPM:
  </p>
  <ul>
    <li>Isi <code>Belanja / Hasil</code> dalam <b>Akaun Perdagangan dan Untung Rugi</b></li>
    <li>Isi <code>akaun semasa + amaun</code> dalam <b>Penyata Kedudukan Kewangan</b></li>
    <li>Nama akaun mesti penuhÔºå‰æãÂ¶ÇÔºö<code>Gaji belum bayar</code>„ÄÅ<code>Insurans prabayar</code>„ÄÅ<code>Sewa diterima belum terima</code>„ÄÅ<code>Hasil belum terperoleh</code> Á≠â„ÄÇ</li>
  </ul>

  <div class="card" id="quizCard" style="display:none;">
    <div id="questionText"></div>

    <label class="label" for="urInput">
      1. Amaun belanja / hasil dalam Akaun Untung Rugi (RM)
    </label>
    <input type="number" id="urInput" autocomplete="off" />

    <label class="label" for="sofpNameInput">
      2. Nama akaun dalam Penyata Kedudukan Kewangan
      <small>(contoh: Gaji belum bayar / Insurans prabayar / Sewa diterima belum terima / Hasil belum terperoleh)</small>
    </label>
    <input type="text" id="sofpNameInput" autocomplete="off" />

    <label class="label" for="sofpAmountInput">
      3. Amaun dalam Penyata Kedudukan Kewangan (RM)
    </label>
    <input type="number" id="sofpAmountInput" autocomplete="off" />

    <div>
      <button id="checkBtn">Semak Jawapan</button>
      <button id="showBtn" type="button">Tunjuk Jawapan</button>
      <button id="nextBtn" type="button">Soalan Seterusnya</button>
    </div>

    <div id="feedback"></div>
    <div id="status"></div>
  </div>

  <p id="loading">Memuatkan soalan...</p>
  <p id="finished" style="display:none;font-weight:600;">
    Semua soalan telah dijawab. Anda boleh refresh untuk ulang latihan.
  </p>

  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const CSV_FILE = "maklumat-belanja-hasil.csv"; // ÊîæÂú®Âêå‰∏Ä‰∏™ folder Â∞±ÂèØ‰ª•
    let questions = [];
    let index = 0;
    let correctCount = 0;
    let totalAnswered = 0;

    function normaliseText(str) {
      return str
        .toLowerCase()
        .replace(/\s+/g, " ")
        .trim();
    }

    function loadCSV() {
      Papa.parse(CSV_FILE, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: (res) => {
          questions = res.data.filter(row => row.id);
          // ÂàùÂßãÂåñÈáçÂ§çËÆ°Êï∞
          questions.forEach(q => q.repeatCount = 0);
          shuffle(questions);
          document.getElementById("loading").style.display = "none";
          if (questions.length > 0) {
            document.getElementById("quizCard").style.display = "block";
            showQuestion();
          }
        }
      });
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function showQuestion() {
      if (index >= questions.length) {
        document.getElementById("quizCard").style.display = "none";
        document.getElementById("finished").style.display = "block";
        return;
      }
      const q = questions[index];

      const text =
        "Kategori: <b>" + q.kategori + "</b><br>" +
        "Item: <b>" + q.item + "</b><br>" +
        q.maklumat_tambahan;

      document.getElementById("questionText").innerHTML = text;
      document.getElementById("urInput").value = "";
      document.getElementById("sofpNameInput").value = "";
      document.getElementById("sofpAmountInput").value = "";
      document.getElementById("feedback").textContent = "";
      updateStatus();
    }

    function updateStatus() {
      const status = document.getElementById("status");
      status.textContent =
        "Soalan " + (index + 1) + " daripada " + questions.length +
        " | Betul: " + correctCount + " / " + totalAnswered;
    }

    function checkAnswer() {
      const q = questions[index];
      const urUser = Number(document.getElementById("urInput").value.trim());
      const sofpNameUser = normaliseText(document.getElementById("sofpNameInput").value);
      const sofpAmountUser = Number(document.getElementById("sofpAmountInput").value.trim());

      const urCorrect = Number(q.amaun_untung_rugi);
      const sofpNameCorrect = normaliseText(q.nama_aset_atau_liabiliti);
      const sofpAmountCorrect = Number(q.amaun_penyata_kewangan);

      let okUR = (urUser === urCorrect);
      let okName = (sofpNameUser === sofpNameCorrect);
      let okAmt = (sofpAmountUser === sofpAmountCorrect);

      totalAnswered++;

      const fb = document.getElementById("feedback");
      if (okUR && okName && okAmt) {
        correctCount++;
        fb.textContent = "Betul! üëç";
        fb.className = "correct";
      } else {
        let msg = "Masih ada yang salah: ";
        const parts = [];
        if (!okUR) parts.push("Untung Rugi");
        if (!okName) parts.push("Nama akaun");
        if (!okAmt) parts.push("Amaun PKK");
        fb.textContent = msg + parts.join(", ");
        fb.className = "wrong";

        // ÊâìÈîôÈ¢òÁõÆÔºöÂÜçÂá∫Áé∞2Ê¨°ÔºàÊÄªÂÖ±ÊúÄÂ§ö 3 Ê¨°Ôºâ
        q.repeatCount = (q.repeatCount || 0) + 1;
        if (q.repeatCount < 3) {
          questions.push(q);
        }
      }

      index++;
      updateStatus();
    }

    function showAnswer() {
      const q = questions[index];
      const fb = document.getElementById("feedback");
      fb.className = "";
      fb.innerHTML =
        "Jawapan:<br>" +
        "UR: <b>RM" + q.amaun_untung_rugi + "</b><br>" +
        "PKK: <b>" + q.nama_aset_atau_liabiliti +
        " RM" + q.amaun_penyata_kewangan + "</b>";
    }

    document.getElementById("checkBtn").addEventListener("click", () => {
      checkAnswer();
      setTimeout(showQuestion, 400);
    });
    document.getElementById("showBtn").addEventListener("click", showAnswer);
    document.getElementById("nextBtn").addEventListener("click", () => {
      index++;
      showQuestion();
    });

    loadCSV();
  </script>
</body>
</html>
